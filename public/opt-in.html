<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign Up for Water Alerts â€” Beulah Park Water System</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f4f1eb;
    --card: #ffffff;
    --coral: #e8927c;
    --coral-light: #fdf0ec;
    --mint: #7ec8a4;
    --mint-light: #edf8f2;
    --blue: #7caee8;
    --blue-light: #ecf3fd;
    --red: #d9534f;
    --red-light: #fdecea;
    --text: #2c2c2c;
    --text-muted: #8a8a8a;
    --border: #e8e4de;
    --shadow: 0 2px 12px rgba(0,0,0,0.06);
    --radius: 16px;
    --radius-sm: 10px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  /* â”€â”€ Header â”€â”€ */
  .header {
    background: var(--card);
    border-bottom: 1px solid var(--border);
    padding: 0 32px;
    display: flex;
    align-items: center;
    height: 64px;
  }

  .logo-link {
    display: flex;
    align-items: center;
    gap: 16px;
    text-decoration: none;
    color: inherit;
  }

  .logo-icon {
    width: 36px;
    height: 36px;
    background: linear-gradient(135deg, var(--blue), var(--mint));
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: white;
  }

  .system-name {
    font-family: 'Fraunces', serif;
    font-size: 18px;
    font-weight: 600;
    color: var(--text);
  }

  /* â”€â”€ Main Content â”€â”€ */
  .container {
    max-width: 520px;
    margin: 0 auto;
    padding: 40px 20px 60px;
  }

  /* â”€â”€ Hero â”€â”€ */
  .hero {
    text-align: center;
    margin-bottom: 32px;
  }

  .hero-icon {
    font-size: 48px;
    margin-bottom: 16px;
  }

  .hero h1 {
    font-family: 'Fraunces', serif;
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 12px;
    line-height: 1.3;
  }

  .hero p {
    color: var(--text-muted);
    font-size: 16px;
    line-height: 1.5;
  }

  /* â”€â”€ Form Card â”€â”€ */
  .form-card {
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 32px;
    margin-bottom: 24px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 6px;
    color: var(--text);
  }

  .form-group input,
  .form-group select {
    width: 100%;
    padding: 12px 16px;
    border: 1.5px solid var(--border);
    border-radius: var(--radius-sm);
    font-family: 'DM Sans', sans-serif;
    font-size: 16px;
    color: var(--text);
    background: var(--card);
    transition: border-color 0.2s;
    -webkit-appearance: none;
  }

  .form-group input:focus,
  .form-group select:focus {
    outline: none;
    border-color: var(--blue);
  }

  .form-group input::placeholder {
    color: var(--text-muted);
  }

  .form-group .hint {
    font-size: 13px;
    color: var(--text-muted);
    margin-top: 4px;
  }

  /* â”€â”€ Consent Checkbox â”€â”€ */
  .consent-group {
    margin: 24px 0;
    padding: 20px;
    background: var(--blue-light);
    border-radius: var(--radius-sm);
  }

  .consent-label {
    display: flex;
    gap: 12px;
    align-items: flex-start;
    cursor: pointer;
    font-size: 14px;
    line-height: 1.5;
    color: var(--text);
  }

  .consent-label input[type="checkbox"] {
    width: 20px;
    height: 20px;
    min-width: 20px;
    margin-top: 2px;
    accent-color: var(--coral);
    cursor: pointer;
  }

  /* â”€â”€ Submit Button â”€â”€ */
  .submit-btn {
    width: 100%;
    padding: 14px;
    background: var(--coral);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    font-family: 'DM Sans', sans-serif;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .submit-btn:hover {
    background: #d4815d;
    transform: translateY(-1px);
  }

  .submit-btn:active {
    transform: translateY(0);
  }

  .submit-btn:disabled {
    background: var(--border);
    cursor: not-allowed;
    transform: none;
  }

  /* â”€â”€ Error / Status Messages â”€â”€ */
  .form-error {
    display: none;
    background: var(--red-light);
    color: var(--red);
    padding: 12px 16px;
    border-radius: var(--radius-sm);
    font-size: 14px;
    margin-bottom: 16px;
  }

  .form-error.visible {
    display: block;
  }

  /* â”€â”€ Success State â”€â”€ */
  .success-card {
    display: none;
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 48px 32px;
    text-align: center;
  }

  .success-card.visible {
    display: block;
  }

  .success-icon {
    font-size: 56px;
    margin-bottom: 20px;
  }

  .success-card h2 {
    font-family: 'Fraunces', serif;
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 12px;
  }

  .success-card p {
    color: var(--text-muted);
    font-size: 15px;
    line-height: 1.6;
    max-width: 380px;
    margin: 0 auto;
  }

  /* â”€â”€ Disclosure Section â”€â”€ */
  .disclosure {
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 28px 32px;
    margin-bottom: 24px;
  }

  .disclosure h3 {
    font-family: 'Fraunces', serif;
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 16px;
  }

  .disclosure-item {
    display: flex;
    gap: 12px;
    margin-bottom: 12px;
    font-size: 14px;
    line-height: 1.5;
    color: var(--text-muted);
  }

  .disclosure-item:last-child {
    margin-bottom: 0;
  }

  .disclosure-icon {
    font-size: 16px;
    min-width: 20px;
    text-align: center;
  }

  /* â”€â”€ Footer â”€â”€ */
  .footer {
    text-align: center;
    padding: 24px 20px;
    font-size: 13px;
    color: var(--text-muted);
  }

  /* â”€â”€ Responsive â”€â”€ */
  @media (max-width: 600px) {
    .header { padding: 0 16px; }
    .container { padding: 24px 16px 40px; }
    .form-card, .disclosure { padding: 24px 20px; }
    .hero h1 { font-size: 24px; }
    .consent-group { padding: 16px; }
  }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <a class="logo-link" href="/">
    <div class="logo-icon">ðŸ’§</div>
    <span class="system-name">Beulah Park Water</span>
  </a>
</div>

<!-- Main Content -->
<div class="container">

  <!-- Hero -->
  <div class="hero">
    <div class="hero-icon">ðŸ“±</div>
    <h1>Sign Up for Water System Alerts</h1>
    <p>Get notified by text message when there are water service disruptions, repairs, or boil water notices in your area.</p>
  </div>

  <!-- Signup Form -->
  <div class="form-card" id="formCard">
    <form id="optInForm" novalidate>

      <div class="form-error" id="formError"></div>

      <div class="form-group">
        <label for="name">Full Name</label>
        <input type="text" id="name" name="name" placeholder="Jane Smith" required autocomplete="name">
      </div>

      <div class="form-group">
        <label for="phone">Phone Number</label>
        <input type="tel" id="phone" name="phone" placeholder="(555) 123-4567" required autocomplete="tel">
        <div class="hint">US mobile number where you'd like to receive alerts</div>
      </div>

      <div class="form-group">
        <label for="zone">Service Zone <span style="font-weight: 400; color: var(--text-muted);">(optional)</span></label>
        <select id="zone" name="zone">
          <option value="all">All Zones</option>
          <option value="Zone 1">Zone 1</option>
          <option value="Zone 2">Zone 2</option>
          <option value="Zone 3">Zone 3</option>
        </select>
        <div class="hint">Select your zone to only receive alerts for your area</div>
      </div>

      <div class="consent-group">
        <label class="consent-label">
          <input type="checkbox" id="consent" name="consent" required>
          <span>I agree to receive automated SMS alerts from Beulah Park Water System regarding water service disruptions, repairs, and boil water notices. Message frequency varies. Message and data rates may apply. Reply STOP to unsubscribe at any time.</span>
        </label>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">Sign Up for Alerts</button>
    </form>
  </div>

  <!-- Success State (hidden until form submits) -->
  <div class="success-card" id="successCard">
    <div class="success-icon">âœ…</div>
    <h2>You're Signed Up!</h2>
    <p>You'll receive a text message when there are water system issues in your area. Reply STOP at any time to unsubscribe.</p>
  </div>

  <!-- Disclosure -->
  <div class="disclosure">
    <h3>About These Alerts</h3>
    <div class="disclosure-item">
      <span class="disclosure-icon">ðŸ”§</span>
      <span><strong>What you'll receive:</strong> Notifications about water main repairs, service outages, and boil water notices affecting the Beulah Park water system.</span>
    </div>
    <div class="disclosure-item">
      <span class="disclosure-icon">ðŸ“…</span>
      <span><strong>How often:</strong> Only when there's an active issue â€” typically a few times per year. We won't send marketing or promotional messages.</span>
    </div>
    <div class="disclosure-item">
      <span class="disclosure-icon">ðŸ›‘</span>
      <span><strong>Opt out anytime:</strong> Reply STOP to any message to immediately unsubscribe. Reply HELP for assistance.</span>
    </div>
    <div class="disclosure-item">
      <span class="disclosure-icon">ðŸ’°</span>
      <span><strong>Cost:</strong> This service is free. Standard message and data rates from your carrier may apply.</span>
    </div>
    <div class="disclosure-item">
      <span class="disclosure-icon">ðŸ“§</span>
      <span><strong>Questions:</strong> Contact the Beulah Park Water System office for any questions about this alert service.</span>
    </div>
  </div>

  <div class="footer">
    &copy; 2026 Beulah Park Water System
  </div>
</div>

<script>
  // â”€â”€ Phone Number Formatting â”€â”€
  const phoneInput = document.getElementById('phone');

  phoneInput.addEventListener('input', (e) => {
    let digits = e.target.value.replace(/\D/g, '');
    // Remove leading 1 if they typed it
    if (digits.length > 0 && digits[0] === '1' && digits.length > 10) {
      digits = digits.substring(1);
    }
    // Cap at 10 digits
    digits = digits.substring(0, 10);

    // Format as (XXX) XXX-XXXX
    let formatted = '';
    if (digits.length > 0) formatted = '(' + digits.substring(0, 3);
    if (digits.length >= 3) formatted += ') ';
    if (digits.length > 3) formatted += digits.substring(3, 6);
    if (digits.length >= 6) formatted += '-';
    if (digits.length > 6) formatted += digits.substring(6, 10);

    e.target.value = formatted;
  });

  // â”€â”€ Form Submission â”€â”€
  const form = document.getElementById('optInForm');
  const formCard = document.getElementById('formCard');
  const successCard = document.getElementById('successCard');
  const formError = document.getElementById('formError');
  const submitBtn = document.getElementById('submitBtn');

  function showError(msg) {
    formError.textContent = msg;
    formError.classList.add('visible');
  }

  function hideError() {
    formError.classList.remove('visible');
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    hideError();

    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const zone = document.getElementById('zone').value;
    const consent = document.getElementById('consent').checked;

    // Validate
    if (!name) {
      showError('Please enter your name.');
      return;
    }

    const digits = phone.replace(/\D/g, '');
    if (digits.length !== 10) {
      showError('Please enter a valid 10-digit phone number.');
      return;
    }

    if (!consent) {
      showError('You must agree to receive alerts to sign up.');
      return;
    }

    // Disable button while submitting
    submitBtn.disabled = true;
    submitBtn.textContent = 'Signing up...';

    try {
      const response = await fetch('/api/subscribers', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name,
          phone,
          zone,
          status: 'active'
        })
      });

      const data = await response.json();

      if (!response.ok) {
        if (response.status === 409) {
          showError('This phone number is already registered for alerts.');
        } else {
          showError(data.error || 'Something went wrong. Please try again.');
        }
        submitBtn.disabled = false;
        submitBtn.textContent = 'Sign Up for Alerts';
        return;
      }

      // Success â€” swap form for confirmation
      formCard.style.display = 'none';
      successCard.classList.add('visible');

    } catch (err) {
      showError('Unable to connect. Please check your connection and try again.');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Sign Up for Alerts';
    }
  });
</script>

</body>
</html>
